<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marketing Intelligence App - V6.3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .modal-overlay { transition: opacity 0.3s ease; }
        .modal-container { transition: transform 0.3s ease; }
        .sidebar { transition: width 0.3s ease; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app" class="flex h-screen">
        <!-- Sol Navigasyon Menüsü (Sidebar) -->
        <aside id="sidebar" class="sidebar bg-white w-64 flex-shrink-0 border-r border-gray-200 flex-col hidden">
            <!-- Logo -->
            <div class="h-16 flex items-center justify-center border-b border-gray-200">
                <h1 class="text-xl font-bold text-indigo-600">Marketing Intelligence</h1>
            </div>
            <!-- Menü -->
            <nav id="nav-menu" class="flex-grow px-4 py-4 space-y-2">
                <!-- Menü JavaScript ile buraya eklenecek -->
            </nav>
            <!-- Kullanıcı Profili -->
            <div class="border-t border-gray-200 p-4">
                 <div class="flex items-center space-x-3">
                    <img class="h-10 w-10 rounded-full" src="https://placehold.co/100x100/E2E8F0/4A5568?text=M" alt="Merve Profil Fotoğrafı">
                    <div>
                        <p class="text-sm font-semibold text-gray-800">Merve Yılmaz</p>
                        <a href="#" class="text-xs text-gray-500 hover:text-indigo-600">Profili Görüntüle</a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Ana İçerik Alanı -->
        <main id="main-content" class="flex-1 flex flex-col overflow-hidden">
            <!-- Header (Sadece ana ekranlarda görünecek) -->
            <header id="main-header" class="bg-white shadow-sm hidden">
                <div class="h-16 flex items-center justify-between px-8">
                    <h2 id="view-title" class="text-2xl font-bold text-gray-900"></h2>
                    <button class="bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-300 text-sm">
                        Yeni Rapor Oluştur
                    </button>
                </div>
            </header>
            <!-- İçerik -->
            <div id="content-area" class="flex-1 overflow-y-auto p-8">
                <!-- GÖRÜNÜMLER İÇİN KONTEYNER -->
                <div id="setup-view"></div>
                <div id="dashboard-view"></div>
                <div id="journeys-view"></div>
                <div id="channels-view"></div>
                <div id="products-view"></div>
                <div id="strategy-view"></div>
                <div id="audiences-view"></div>
                <div id="creatives-view"></div>
            </div>
        </main>
    </div>

    <!-- Modal Pencereleri -->
    <div id="modal-container"></div>

    <script>
        // ===================================================================================
        // UYGULAMA BEYNİ (JAVASCRIPT KODU) - V6.3 (TÜM ÖZELLİKLER BİRLEŞTİRİLDİ)
        // ===================================================================================
        const App = {
            // 1. UYGULAMA DURUMU (STATE)
            state: {
                currentView: 'setup',
                integrations: {
                    shopify: { name: 'Shopify', connected: false, logo: '<svg class="w-12 h-12" role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Shopify</title><path d="M13.283 3.292c-2.422 1.33-3.838 3.868-3.838 6.613 0 1.29.308 2.503.857 3.587l-.003.004.002.003c.532 1.056 1.32 1.961 2.28 2.648l.003.002.002.001c.942.673 2.028 1.123 3.195 1.302l.004.001.004.001c1.18.18 2.383-.01 3.507-.535l.004-.002.003-.001c1.155-.54 2.15-1.36 2.91-2.395l.003-.004.002-.003c.787-1.072 1.31-2.345 1.49-3.72l.001-.004.001-.004V10.22c-.01-4.08-2.36-7.74-5.91-9.63l-.004-.002-.004-.002c-1.18-.63-2.5-.96-3.86-.96-1.39 0-2.75.35-3.99.99zm-1.43 11.898c-.02-.03-.04-.06-.06-.09l-.003-.005c-.5-1-1.2-1.8-2.07-2.38l-.004-.002-.003-.002c-2.4-1.6-3.8-4.4-3.8-7.3 0-1.3.3-2.5 1-3.6l.002-.003.003-.004c.5-1 1.2-1.8 2.1-2.4l.003-.002.003-.002c2.4-1.6 5.4-2 8.1-.9l.004.001.004.002c-1.9 4.2-6.2 7.2-11.2 7.2h-2.2z" fill="#7AB55C"/></svg>', color: 'green' },
                    ga4: { name: 'Google Analytics 4', connected: false, logo: '<svg class="w-10 h-10" viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg"><rect x="25" y="50" width="15" height="50" rx="7.5" fill="#F4A032"/><rect x="50" y="25" width="15" height="75" rx="7.5" fill="#F4A032"/><rect x="75" y="75" width="15" height="25" rx="7.5" fill="#F4A032"/></svg>', color: 'orange' },
                    google_ads: { name: 'Google Ads', connected: false, logo: '<svg class="w-12 h-12" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.24 12.24l-2.48 2.48-2.48-2.48-2.48 2.48-4.76-4.76 4.76-4.76 2.48 2.48 2.48-2.48 2.48 2.48 4.76 4.76-4.76 4.76z" fill="#4285F4"/><path d="M16.92 14.72l-2.48-2.48 2.48-2.48 4.76-4.76v14.48l-4.76-4.76z" fill="#34A853"/><path d="M7.28 9.52l2.48 2.48-2.48 2.48-4.76 4.76V2.52l4.76 4.76z" fill="#FBBC05"/><path d="M9.76 12.24l2.48-2.48 2.48 2.48-2.48 2.48-2.48-2.48z" fill="#EA4335"/></svg>', color: 'blue' },
                    meta: { name: 'Meta', connected: false, logo: '<svg class="w-12 h-12" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm3.64 16.5c-.247 1.47-1.42 2.643-2.89 2.89-1.85.31-6.39.31-8.24 0-1.47-.247-2.643-1.42-2.89-2.89-.31-1.85-.31-6.39 0-8.24.247-1.47 1.42-2.643 2.89-2.89 1.85-.31 6.39-.31 8.24 0 1.47.247 2.643 1.42 2.89 2.89.31 1.85.31 6.39 0 8.24z" fill="#0062E0"/><path d="M9.75 14.75V9.25l4.5 2.75-4.5 2.75z" fill="#0062E0"/></svg>', color: 'indigo' },
                    tiktok: { name: 'TikTok', connected: false, logo: '<svg class="w-10 h-10" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.53.02C13.84 0 15.14.01 16.44 0c.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.01-1.58-.01-3.16 0-4.75l-.04 1.28c-1.47.6-2.93 1.21-4.4 1.79v4.54c1.38-.47 2.76-.93 4.14-1.39v4.26c-1.45.48-2.9.95-4.35 1.42V24c-1.59 0-3.19 0-4.78 0 .01-1.23.01-2.45 0-3.68-.92-.33-1.85-.64-2.78-.94-.01-1.57.01-3.14-.01-4.71.9-.3 1.8-.6 2.7-.9v4.52c1.46.63 2.92 1.26 4.38 1.87V4.27C9.53 3.2 8.52 2.14 7.5 1.04 8.91.65 10.79.33 12.53.02z" fill="#000000"/></svg>', color: 'black' }
                },
                navigation: [
                    { type: 'heading', label: 'Genel Bakış' },
                    { type: 'item', id: 'dashboard', label: 'Ana Panel', icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>' },
                    { type: 'item', id: 'strategy', label: 'Strateji Merkezi', icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>' },
                    { type: 'heading', label: 'Analiz' },
                    { type: 'item', id: 'channels', label: 'Kanallar', icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 13v-1m4 1v-3m4 3V8M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>' },
                    { type: 'item', id: 'products', label: 'Ürünler', icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>' },
                    { type: 'item', id: 'journeys', label: 'Müşteri Yolculukları', icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' },
                    { type: 'heading', label: 'Varlıklar' },
                    { type: 'item', id: 'audiences', label: 'Hedef Kitleler', icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>' },
                    { type: 'item', id: 'creatives', label: 'Kreatifler', icon: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>' },
                ],
                customers: [],
                recommendations: [],
                channelData: {},
                productData: [],
                currentAction: null
            },

            // 2. BAŞLATMA
            init() {
                console.log("Uygulama V6.3 başlatılıyor...");
                this.render();
            },
            
            // 3. RENDER FONKSİYONLARI
            render() {
                const views = ['setup-view', 'dashboard-view', 'journeys-view', 'channels-view', 'products-view', 'strategy-view', 'audiences-view', 'creatives-view'];
                views.forEach(viewId => {
                    document.getElementById(viewId).style.display = 'none';
                });
                
                const isSetup = this.state.currentView === 'setup';
                document.getElementById('sidebar').style.display = isSetup ? 'none' : 'flex';
                document.getElementById('main-header').style.display = isSetup ? 'none' : 'flex';
                document.getElementById('main-content').style.width = isSetup ? '100%' : 'calc(100% - 16rem)';
                document.getElementById('content-area').classList.toggle('p-8', !isSetup);
                document.getElementById('content-area').classList.toggle('p-0', isSetup);


                const currentViewElement = document.getElementById(`${this.state.currentView}-view`);
                if(currentViewElement) currentViewElement.style.display = 'block';

                if (isSetup) {
                    this.renderSetupView();
                } else {
                    this.renderSidebar();
                    const currentNavItem = this.state.navigation.find(item => item.id === this.state.currentView);
                    document.getElementById('view-title').innerText = currentNavItem ? currentNavItem.label : 'Marketing Intelligence';
                    
                    if (this.state.currentView === 'dashboard') this.renderDashboard();
                    else if (this.state.currentView === 'strategy') this.renderStrategyView();
                    else if (this.state.currentView === 'audiences') this.renderAudiencesView();
                    else if (this.state.currentView === 'journeys') this.renderJourneysView();
                    else if (this.state.currentView === 'channels') this.renderChannelsView();
                    else if (this.state.currentView === 'products') this.renderProductsView();
                    else if (this.state.currentView === 'creatives') this.renderCreativesView();
                }
            },
            
            renderSidebar() {
                const container = document.getElementById('nav-menu');
                container.innerHTML = '';
                this.state.navigation.forEach(item => {
                    if (item.type === 'heading') {
                        container.innerHTML += `<h3 class="px-3 pt-4 pb-2 text-xs font-semibold text-gray-500 uppercase tracking-wider">${item.label}</h3>`;
                    } else if (item.type === 'item') {
                        const isActive = this.state.currentView === item.id;
                        container.innerHTML += `<a href="#" onclick="App.switchView('${item.id}')" class="flex items-center px-3 py-2 text-sm font-medium rounded-md ${isActive ? 'bg-indigo-50 text-indigo-600' : 'text-gray-700 hover:bg-gray-50 hover:text-gray-900'}">${item.icon}<span class="ml-3">${item.label}</span></a>`;
                    }
                });
            },
            
            // DİĞER TÜM RENDER FONKSİYONLARI BURADA
            renderSetupView() {
                const container = document.getElementById('setup-view');
                let cardsHTML = '';
                for (const key in this.state.integrations) {
                    const integration = this.state.integrations[key];
                    const buttonColorClass = integration.color === 'black' ? 'bg-black hover:bg-gray-800' : `bg-${integration.color}-600 hover:bg-${integration.color}-700`;
                    cardsHTML += `<div id="card-${key}" class="border ${integration.connected ? `border-${integration.color}-500 bg-${integration.color}-50` : 'border-gray-200'} rounded-lg p-6 flex flex-col items-center justify-between space-y-4 transition-all duration-300"><div class="h-16 flex items-center justify-center">${integration.logo}</div><h3 class="text-lg font-semibold text-center h-12 flex items-center justify-center">${integration.name}</h3><button onclick="App.connect('${key}')" class="w-full ${integration.connected ? 'bg-gray-400 cursor-not-allowed' : buttonColorClass} text-white font-bold py-2 px-4 rounded-lg transition duration-300" ${integration.connected ? 'disabled' : ''}>${integration.connected ? '✓ Bağlandı' : 'Bağlan'}</button></div>`;
                }
                container.innerHTML = `<div class="bg-white p-8 rounded-lg shadow space-y-6"><div class="text-center"><h2 class="text-2xl font-bold">Platforma Hoş Geldiniz!</h2><p class="text-gray-600 mt-2">Başlamak için lütfen tüm veri kaynaklarınızı bağlayın.</p></div><div id="integration-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6">${cardsHTML}</div><div id="analysis-message" class="hidden text-center pt-6"><div class="animate-pulse-slow inline-block"><svg class="w-12 h-12 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M12 6V3m0 18v-3M5.636 5.636l-1.414-1.414M19.778 19.778l-1.414-1.414M18.364 5.636l1.414-1.414M4.222 19.778l1.414-1.414"></path></svg></div><h3 class="text-xl font-semibold mt-4">Harika! Verilerinizi analiz etmeye başladık.</h3><p class="text-gray-600 mt-2">Ana panele yönlendiriliyorsunuz...</p></div></div>`;
            },
            renderDashboard() {
                const container = document.getElementById('dashboard-view');
                container.innerHTML = `<div id="summary-metrics" class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3"></div><div class="mt-8"><h3 class="text-xl font-semibold text-gray-900">Bugünün Aksiyon Önerileri</h3><div id="recommendations-container" class="mt-4 bg-white shadow rounded-lg p-6 space-y-6"></div></div>`;
                this.renderSummaryMetrics();
                this.renderRecommendations();
            },
            renderJourneysView() {
                const container = document.getElementById('journeys-view');
                container.innerHTML = `<div class="grid grid-cols-1 md:grid-cols-3 gap-8"><div class="md:col-span-1 bg-white shadow rounded-lg p-4"><h3 class="text-lg font-semibold text-gray-900 mb-4">Son Müşteriler</h3><ul id="customer-list" class="space-y-2"></ul></div><div id="customer-journey-detail" class="md:col-span-2 bg-white shadow rounded-lg p-6"></div></div>`;
                this.renderCustomerList();
                this.renderCustomerJourneyDetail();
            },
            renderChannelsView() {
                const container = document.getElementById('channels-view');
                if (Object.keys(this.state.channelData).length === 0) { container.innerHTML = `<p class="text-center text-gray-500">Kanal verileri yükleniyor...</p>`; return; }
                let content = '<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">';
                for(const key in this.state.channelData) {
                    const channel = this.state.channelData[key];
                    content += `<div class="bg-white shadow rounded-lg p-6"><h3 class="text-2xl font-bold text-gray-900 mb-4">${channel.name}</h3><div class="space-y-4"><div class="flex justify-between items-center border-b pb-2"><span class="text-gray-600">Reklam Harcaması</span><span class="font-semibold text-lg">₺${channel.spend.toLocaleString('tr-TR')}</span></div><div class="flex justify-between items-center border-b pb-2"><span class="text-gray-600">Getirilen Ciro</span><span class="font-semibold text-lg">₺${channel.revenue.toLocaleString('tr-TR')}</span></div><div class="flex justify-between items-center border-b pb-2"><span class="text-gray-600">Reklam Kârlılığı (ROAS)</span><span class="font-bold text-xl ${channel.roas > 4 ? 'text-green-600' : 'text-orange-500'}">${channel.roas.toFixed(2)}x</span></div></div></div>`;
                }
                content += '</div>';
                container.innerHTML = content;
            },
            renderProductsView() {
                const container = document.getElementById('products-view');
                if (this.state.productData.length === 0) { container.innerHTML = `<p class="text-center text-gray-500">Ürün performans verileri yükleniyor...</p>`; return; }
                let tableHTML = `<div class="bg-white shadow rounded-lg overflow-hidden"><table class="min-w-full divide-y divide-gray-200"><thead class="bg-gray-50"><tr><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ürün</th><th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Toplam Ciro</th></tr></thead><tbody class="bg-white divide-y divide-gray-200">`;
                this.state.productData.forEach(product => { tableHTML += `<tr><td class="px-6 py-4 whitespace-nowrap"><div class="flex items-center"><div class="flex-shrink-0 h-10 w-10"><img class="h-10 w-10 rounded-full" src="https://placehold.co/40x40/111827/FFFFFF?text=P" alt="${product.name}"></div><div class="ml-4"><div class="text-sm font-medium text-gray-900">${product.name}</div></div></div></td><td class="px-6 py-4 whitespace-nowrap"><div class="text-sm font-bold text-gray-900">₺${product.totalRevenue.toLocaleString('tr-TR')}</div></td></tr>`; });
                tableHTML += `</tbody></table></div>`;
                container.innerHTML = tableHTML;
            },
            renderStrategyView() {
                const container = document.getElementById('strategy-view');
                container.innerHTML = `<div class="space-y-8"><div><h3 class="text-xl font-semibold">Strateji Şablonları</h3><p class="mt-1 text-gray-600">İş hedeflerinize uygun, kanıtlanmış bir stratejiyi tek tıkla başlatın.</p></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow"><h4 class="text-lg font-bold text-gray-900">Marka Bilinirliği</h4><p class="mt-2 text-sm text-gray-600 h-16">Yeni müşterilere ulaşın ve markanızın tanınırlığını artırın.</p><button onclick="App.launchStrategy('awareness')" class="mt-4 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Stratejiyi Başlat</button></div><div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow"><h4 class="text-lg font-bold text-gray-900">Dönüşüm Odaklı</h4><p class="mt-2 text-sm text-gray-600 h-16">Doğrudan satışları ve web sitesi dönüşümlerini artırın.</p><button onclick="App.launchStrategy('conversion')" class="mt-4 w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700">Stratejiyi Başlat</button></div><div class="bg-white p-6 rounded-lg shadow hover:shadow-lg transition-shadow"><h4 class="text-lg font-bold text-gray-900">Yeniden Pazarlama</h4><p class="mt-2 text-sm text-gray-600 h-16">Sitenizi daha önce ziyaret etmiş kullanıcıları geri kazanın.</p><button onclick="App.launchStrategy('retargeting')" class="mt-4 w-full bg-orange-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-orange-600">Stratejiyi Başlat</button></div></div></div>`;
            },
            renderAudiencesView() {
                const container = document.getElementById('audiences-view');
                container.innerHTML = `<div class="bg-white shadow rounded-lg"><div class="p-6"><h3 class="text-xl font-semibold">Otomatik Oluşturulan Hedef Kitleler</h3><p class="mt-1 text-gray-600">Reklam kampanyalarında kullanıma hazır kitleler.</p></div><ul class="divide-y divide-gray-200"><li class="p-4 flex justify-between items-center"><div><p class="font-medium text-indigo-600">Benzer Kitle (Lookalike) - Satın Alanlar %1</p><p class="text-sm text-gray-500">En değerli müşterilerinize benzeyen yeni kullanıcılar.</p></div><span class="text-sm font-semibold text-gray-700">Potansiyel: 1.5 Milyon</span></li><li class="p-4 flex justify-between items-center"><div><p class="font-medium">Web Sitesi Ziyaretçileri - Son 30 Gün</p><p class="text-sm text-gray-500">Sitenizi son 1 ayda ziyaret eden herkes.</p></div><span class="text-sm font-semibold text-gray-700">Boyut: 15,240</span></li></ul></div>`;
            },
            renderCreativesView() {
                const container = document.getElementById('creatives-view');
                container.innerHTML = `<p>Kreatifler ekranı burada olacak.</p>`;
            },
            renderSummaryMetrics() {
                const container = document.getElementById('summary-metrics'); if(!container) return;
                const totalRevenue = 48750; const totalSpend = 11200; const totalRoas = totalSpend > 0 ? totalRevenue / totalSpend : 0;
                const metrics = [ { label: 'Toplam Ciro (Son 7 Gün)', value: `₺${totalRevenue.toLocaleString('tr-TR')}`}, { label: 'Reklam Harcaması (Son 7 Gün)', value: `₺${totalSpend.toLocaleString('tr-TR')}`}, { label: 'Reklam Kârlılığı (ROAS)', value: `${totalRoas.toFixed(2)}x`, isGreen: true } ];
                container.innerHTML = ''; metrics.forEach(metric => { container.innerHTML += `<div class="bg-white overflow-hidden shadow rounded-lg p-5"><div class="flex items-center"><div class="flex-shrink-0"><!-- icon --></div><div class="ml-5 w-0 flex-1"><dl><dt class="text-sm font-medium text-gray-500 truncate">${metric.label}</dt><dd class="text-3xl font-bold ${metric.isGreen ? 'text-green-600' : 'text-gray-900'}">${metric.value}</dd></dl></div></div></div>`; });
            },
            renderRecommendations() {
                const container = document.getElementById('recommendations-container'); if(!container) return;
                container.innerHTML = ''; if(this.state.recommendations.length === 0) { container.innerHTML = `<p class="text-center text-gray-500">Analiz devam ediyor...</p>`; return; }
                this.state.recommendations.forEach(rec => { const colors = { opportunity: { border: 'green-200', bg: 'green-50', text: 'green-800', button: 'bg-green-600 hover:bg-green-700' }, risk: { border: 'red-200', bg: 'red-50', text: 'red-800', button: 'bg-red-600 hover:bg-red-700' }, insight: { border: 'blue-200', bg: 'blue-50', text: 'blue-800', button: '' } }; const theme = colors[rec.type]; container.innerHTML += `<div id="rec-${rec.id}" class="flex items-start space-x-4 p-4 border border-${theme.border} bg-${theme.bg} rounded-lg"> <div class="flex-shrink-0"><!-- icon --></div> <div> <h4 class="text-lg font-bold text-${theme.text}">${rec.title}</h4> <p class="text-gray-700 mt-1">${rec.description}</p> ${rec.action ? `<button onclick="App.openModal('${rec.id}', '${rec.action.title}', '${rec.action.body}')" class="mt-3 ${theme.button} text-white font-bold py-2 px-4 rounded-lg transition duration-300 text-sm">Tek Tıkla Onayla</button>` : ''} </div> </div>`; });
            },
            renderCustomerList() {
                const container = document.getElementById('customer-list'); if(!container) return;
                container.innerHTML = ''; this.state.customers.forEach(customer => { const isSelected = this.state.selectedCustomerId === customer.id; container.innerHTML += `<li onclick="App.selectCustomer(${customer.id})" class="p-3 rounded-lg cursor-pointer ${isSelected ? 'bg-indigo-100' : 'hover:bg-gray-100'}"><p class="font-semibold text-sm ${isSelected ? 'text-indigo-800' : 'text-gray-800'}">${customer.email}</p><div class="flex justify-between text-xs mt-1 ${isSelected ? 'text-indigo-600' : 'text-gray-500'}"><span>₺${customer.totalSpend}</span><span>${customer.date}</span></div></li>`; });
            },
            renderCustomerJourneyDetail() {
                const container = document.getElementById('customer-journey-detail'); if(!container) return;
                const customer = this.state.customers.find(c => c.id === this.state.selectedCustomerId); if (!customer) { container.innerHTML = `<p class="text-center text-gray-500">Detayları görmek için bir müşteri seçin.</p>`; return; }
                let journeyHTML = `<h3 class="text-lg font-bold text-gray-900 mb-6">${customer.email}'in Yolculuğu</h3><ol class="relative border-l border-gray-200">`; customer.journey.forEach(step => { journeyHTML += `<li class="mb-6 ml-6"><span class="absolute flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full -left-3 ring-8 ring-white">${step.icon}</span><h4 class="flex items-center mb-1 text-base font-semibold text-gray-900">${step.event}</h4><time class="block mb-2 text-sm font-normal leading-none text-gray-400">${step.date}</time><p class="text-sm text-gray-600">${step.detail}</p></li>`; }); journeyHTML += `</ol>`; container.innerHTML = journeyHTML;
            },

            // AKSİYONLAR
            switchView(viewId) {
                this.state.currentView = viewId;
                this.render();
            },
            connect(platformKey) {
                this.state.integrations[platformKey].connected = true;
                const allConnected = Object.values(this.state.integrations).every(p => p.connected);
                if (allConnected) {
                    this.state.currentView = 'dashboard';
                    this.fetchData();
                } else {
                    this.render();
                }
            },
            fetchData() {
                 setTimeout(() => {
                    this.state.customers = [ { id: 1, email: 'ayse.y@example.com', totalSpend: 450, date: '1 saat önce', journey: [{ event: 'Meta Reklamı Tıkladı', detail: 'Yaz Koleksiyonu Kampanyası', date: '3 gün önce', icon: 'M' }, { event: 'Siteyi Ziyaret Etti', detail: '5 sayfa gezdi', date: '3 gün önce', icon: '🌐' }, { event: 'Sepete Ekledi', detail: 'Yüksek Bel Siyah Bikini', date: '1 gün önce', icon: '🛒' }, { event: 'Satın Aldı', detail: 'Sipariş #1058', date: '1 saat önce', icon: '✅' }] }, { id: 2, email: 'burak.c@example.com', totalSpend: 280, date: '8 saat önce', journey: [{ event: 'Google Reklamı Tıkladı', detail: 'Bikini Modelleri Araması', date: '2 gün önce', icon: 'G' }, { event: 'Satın Aldı', detail: 'Sipariş #1057', date: '8 saat önce', icon: '✅' }] }, { id: 3, email: 'canan.s@example.com', totalSpend: 620, date: '1 gün önce', journey: [{ event: 'Siteyi Ziyaret Etti', detail: 'Organik Trafik', date: '5 gün önce', icon: '🌐' }, { event: 'E-posta Bültenine Kaydoldu', detail: 'Hoş geldin indirimi', date: '4 gün önce', icon: '✉️' }, { event: 'E-postayı Tıkladı', detail: 'Yeni Sezon Kampanyası', date: '1 gün önce', icon: '🖱️' }, { event: 'Satın Aldı', detail: 'Sipariş #1056', date: '1 gün önce', icon: '✅' }] } ];
                    this.state.selectedCustomerId = this.state.customers[0]?.id;
                    this.state.recommendations = [ { id: 1, type: 'opportunity', title: 'Fırsat: Yüksek Performanslı Reklam', description: '"Yüksek Bel Siyah Bikini" için yürüttüğünüz Instagram reklamı son 3 günde **7.2x ROAS** getirdi. Bu reklamın günlük bütçesini 150 TL\'den 250 TL\'ye çıkararak potansiyeli artırmanızı öneriyoruz.', action: { title: 'Bütçeyi Artır', body: 'Bu reklamın günlük bütçesi 150 TL\'den 250 TL\'ye çıkarılacak. Onaylıyor musunuz?' } }, { id: 2, type: 'risk', title: 'Risk: Para Yakan Kampanya', description: '"Plaj Çantası" için yürüttüğünüz Google Ads kampanyası son 48 saattir kârlılığın altında (**0.8x ROAS**). Bu kampanyayı geçici olarak duraklatarak bütçenizi korumanızı öneriyoruz.', action: { title: 'Kampanyayı Duraklat', body: 'Bu kampanya geçici olarak duraklatılacak. Onaylıyor musunuz?' } }, { id: 3, type: 'insight', title: 'İçgörü: Müşteri Davranışı', description: 'Verilerinize göre, sitenizi mobil cihazdan ziyaret eden müşterilerin dönüşüm oranı, masaüstü kullanıcılardan **%35 daha yüksek**. Mobil reklamlarınıza ağırlık vermeyi düşünebilirsiniz.', action: null } ];
                    this.state.channelData = { google: { name: 'Google Ads', spend: 4200, revenue: 21000, roas: 5.0, conversions: 45, cpc: 3.50 }, meta: { name: 'Meta Ads', spend: 7000, revenue: 27750, roas: 3.96, conversions: 62, cpc: 2.80 } };
                    this.state.productData = [ { id: 1, name: 'Yüksek Bel Siyah Bikini', totalRevenue: 18500 }, { id: 2, name: 'Tropikal Desenli Tek Parça', totalRevenue: 12200 }, { id: 3, name: 'Kırmızı Üçgen Bikini', totalRevenue: 9800 }, { id: 4, name: 'Plaj Çantası', totalRevenue: 8250 }, ];
                    this.render();
                }, 100);
            },
            launchStrategy(strategyType) {
                const modalContainer = document.getElementById('modal-container');
                modalContainer.innerHTML = `<div id="strategy-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4"><div class="bg-white w-full max-w-md rounded-lg shadow-lg p-8"><h3 class="text-xl font-bold text-center">Strateji Oluşturuluyor...</h3><div id="strategy-progress" class="mt-6 space-y-3"><p class="text-gray-600 animate-pulse">1/3: Verileriniz analiz ediliyor ve hedef kitleler oluşturuluyor...</p></div></div></div>`;
                setTimeout(() => { document.getElementById('strategy-progress').innerHTML += `<p class="text-gray-600 animate-pulse">2/3: En iyi performanslı kreatifleriniz seçiliyor ve reklamlar hazırlanıyor...</p>`; }, 2000);
                setTimeout(() => { document.getElementById('strategy-progress').innerHTML += `<p class="text-gray-600 animate-pulse">3/3: Kampanyalar Google ve Meta'ya gönderiliyor...</p>`; }, 4000);
                setTimeout(() => { const modal = document.getElementById('strategy-modal'); modal.querySelector('div').innerHTML = `<div class="text-center"><svg class="w-16 h-16 text-green-500 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><h3 class="text-xl font-bold mt-4">Stratejiniz Başarıyla Başlatıldı!</h3><p class="mt-2 text-gray-600">Kampanya performansını 24 saat içinde Ana Panel'den takip edebilirsiniz.</p><button onclick="App.closeStrategyModal()" class="mt-6 bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg">Harika!</button></div>`; }, 6000);
            },
            closeStrategyModal() {
                document.getElementById('modal-container').innerHTML = '';
                this.switchView('dashboard');
            },
            openModal(recId, title, body) {
                this.state.currentAction = recId;
                const modalContainer = document.getElementById('modal-container');
                modalContainer.innerHTML = `<div id="confirmation-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4" onclick="App.closeModal()"><div class="modal-container bg-white w-full max-w-md rounded-lg shadow-lg p-6 transform scale-95" onclick="event.stopPropagation()"><h3 id="modal-title" class="text-xl font-bold text-gray-900">${title}</h3><p id="modal-body" class="mt-2 text-gray-600">${body}</p><div class="mt-6 flex justify-end space-x-4"><button onclick="App.closeModal()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">İptal</button><button id="modal-confirm-button" onclick="App.confirmAction()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Evet, Onayla</button></div></div></div>`;
            },
            closeModal() {
                document.getElementById('modal-container').innerHTML = '';
            },
            confirmAction() {
                if (!this.state.currentAction) return;
                const button = document.querySelector(`#rec-${this.state.currentAction} button`);
                if(button) {
                    button.disabled = true;
                    button.innerText = 'İşlem Uygulanıyor...';
                    setTimeout(() => { button.innerText = '✓ Uygulandı'; }, 2000);
                }
                this.closeModal();
                this.state.currentAction = null;
            },
            selectCustomer(customerId) {
                this.state.selectedCustomerId = customerId;
                this.render();
            }
        };

        // Uygulamayı başlat
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>

</body>
</html>
